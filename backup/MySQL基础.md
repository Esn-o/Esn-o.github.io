## 数据库概述

**介绍**

数据库(Database)是按照数据结构来组织、存储和管理数据的仓库，是一个长期存储在计算机内的、有组织的、可共享的、统一管理的数据集合。通俗地说，数据库就是存储数据的仓库。

使用数据库来存储海量数据，优势：

> 1. 持久化存储；
> 2. 可以使用表格式结构高效保持；
> 3. 读写效率极高。

**分类**

按数据库是否遵循SQL语法标准来进行分类，可分为：

> 1. 关系型数据库
> 2. 非关系型数据库

关系型数据库SQL，是指采用了关系模型来组织数据的数据库。

非关系型数据库NoSQL（Not Only SQL )，表示不仅仅是SQL。NoSQL指的是非关联型的，强调Key-Value(字典)的方式存储数据，可以理解为可以通过Key来找到Value。

常见的关系型数据库：

|  数据库   | 介绍                                                         |
| :-------: | ------------------------------------------------------------ |
|   MySQL   | 开源免费的数据库，中型的数据库。已经被Oracle收购了，MySQL 6.x版本也开始收费。 |
|  Oracle   | 最早商品化的收费大型数据库，Oracle公司的产品。               |
|    DB2    | IBM公司收费的数据库产品，常应用在银行系统中。                |
| SQLserver | MicroSoft公司收费的中型的数据库，常用于C#、.net等语言。      |
|  SQLite   | 轻型数据库，也是关系型数据库，它包含在一个相对小的C库中，常应用在嵌入式产品中，例如智能手机端，如安卓、苹果手机。 |

常见的非关系型数据库：

| 数据库  | 介绍                                                         |
| :-----: | ------------------------------------------------------------ |
|  Redis  | Redis一个小而美的数据库，主要用在key-value的内存缓存，读写性能极佳。 |
|  HBase  | HBase是列式数据库，目标是高效存储大量数据。                  |
| MongoDB | MongoDB是文档型数据库，非常接近关系型数据库的。              |

两者区别：

> 1. SQL结构化程度较高，安全性高，但查询效率低一些；
> 2. NoSQL查询效率非常高，但采用key-value形式存储，安全性不高。

## MYSQL介绍与使用

**-介绍**

MySQL是一个关系型数据库，是一个应用软件。

MYSQL特点：

> （1）MySQL是开源的；
>
> （2）MySQL支持大量数据处理，可以处理上千万条的数据记录；
>
> （3）MySQL使用标准的SQL语言形式；
>
> （4）MySQL可以安装在不同的操作系统，并且提供了多种编程语言的操作接口，包括Python、	Java、PHP、C++、Ruby等；
>
> （5）支持多种存储引擎。

**-使用**

连接MySQL：

1.本地连接

> mysql -u 用户名 -p
> mysql -u用户名 -p密码

2.加IP地址连接

> mysql -h IP地址 -P 3306 -u 用户名 -p密码

退出MySQL连接：

> 1:exit
> 2:quit

**-SQL语句**

SQL即结构化查询语言(Structured Query Language)，是一种特殊目的的编程语言，是一种数据库查询和程序设计语言，用于存取数据以及查询、更新和管理关系数据库系统；同时也是数据库脚本文件的扩展名。

SQL语句在处理数据时，通常具有定义、操作、查询和控制关系型数据库的这四个功能，表示为：

1.数据控制语言：简称DCL(Data Control Language)。用来定义数据库的访问权限和安全级别，及创建用户。（几乎不用）

2.数据定义语言：简称DDL(Data Definition Language)。

| 内容                       | 用法                                      |
| -------------------------- | ----------------------------------------- |
| 用来定义数据库和数据表对象 | 例如，定义数据库、表、列等。              |
| 常用关键字                 | 例如，创建create、修改alter、删除drop等。 |

3.数据操作语言：简称DML(Data Manipulation Language)。

| 内容           | 用法                                         |
| -------------- | -------------------------------------------- |
| 用来更新数据表 | 例如，插入表字段数据、删除数据、更新数据等。 |
| 常用关键字     | 例如，插入insert、修改update、删除delete等。 |

4.数据查询语言：简称DQL(Data Query Language)。

| 内容                             | 用法                          |
| -------------------------------- | ----------------------------- |
| 用来查询数据表的数据记录(条数)。 | 例如，查询数据、某条件等。    |
| 常用关键字                       | 例如，select、from、where等。 |

**SQL语法特点**

在MySQL数据库中，SQL语法有几个常见的特点：

> 1. SQL语句必须以;(分号)结尾
> 2. 可以使用空格符缩进来提升SQL语句的阅读性
> 3. SQL语句不区分大小写,但SQL关键字一般建议初学者使用小写
> 4. SQL语句中可以使用必要的注释做解释说明

## 数据类型

在MySQL数据库中，常用的字段类型如下：

整数：int

|    类型     |    类型名称    | 说明                                       | 字节大小 |
| :---------: | :------------: | ------------------------------------------ | -------- |
| **tinyint** |   很小的整数   | -128 ~ 127                                 | 1        |
|  smallint   |    小的整数    | -32768 ~ 32767                             | 2        |
|  mediumint  | 中等大小的整数 | -8388608 ~ 8388607                         | 3        |
|   **int**   | 普通大小的整数 | -2147483648 ~ 2147483647                   | 4        |
|   bigint    |  大整型的整数  | -9223372036854775808 ~ 9223372036854775807 | 8        |

浮点数：double

|     类型     | 类型名称                                   |
| :----------: | ------------------------------------------ |
|    float     | 单精度浮点数。                             |
|  **double**  | 双精度浮点数。                             |
| decimal(m,d) | 定点数，m表示整数的总长度，d表示小数长度。 |

字符串：varchar

|      类型      | 说明                                                       | 使用场景                         |
| :------------: | ---------------------------------------------------------- | -------------------------------- |
| **char[(m)]**  | 固定长度，小型数据，m为0~255之间的整数定长（固定长度）。   | 身份证号、手机号、电话           |
| **varchar(m)** | 可变长度，小型数据，m为0~65535之间的整数变长（变化长度）。 | 密码、姓名、地址、品牌、型号     |
|      text      | 可变长度，字符个数大于 4000，允许长度0~65535字节。         | 小型文章、技术博客、新闻正文     |
|   mediumtext   | 可变长度， 中型文本数据，允许长度0~167772150字节。         | 中型文本数据，例如论文内容       |
|    longtext    | 可变长度， 极大型文本数据，允许长度0~4294967295字节。      | 极大型文本数据，例如一本小说内容 |

时间日期：date、datetime

|   类型    | 类型名称                                                     | 示例                                              |
| :-------: | ------------------------------------------------------------ | ------------------------------------------------- |
|   year    | YYYY 1901~2155                                               | 2017                                              |
|   time    | HH:MM:SS -838:59:59~838:59:59                                | 12:29:59                                          |
|   date    | YYYY-MM-DD  1000-01-01~9999-12-3                             | 2020-01-01                                        |
| datetime  | YYYY-MM-DD  HH:MM:SS 1000-01-01 00:00:00~ 9999-12-31 23:59:59 | 2020-01-01 12:29:59                               |
| timestamp | YYYY-MM-DD  HH:MM:SS 1970 ~ 01 ~ 01 00:00:01  UTC~2038-01-19 03:14:07UTC | 1970-01-01 00:00:01 UTC ~ 2038-01-01 00:00:01 UTC |



## DDL

**数据库操作**

创建数据库语法：

```sql
create database [if not exists] 数据库名 [设置编码格式];
```

查看数据库语法:

```sql
# 查看有哪些数据库
show databases;
# 查看数据库的创建语句
show create database 数据库名;
```

删除数据库的语法：

```sql
drop database 数据库名;
```

切换及使用另一个数据库:

```sql
use 数据库名;
```

查看当前正在使用的数据库:

```sql
select database();
```

**数据表操作（增删查）**

创建数据表语法：

```sql
create table 表名(
	字段名 数据类型(长度) [约束]...
);
```

查看数据表语法：

```sql
# 查看有哪些表
show tables;
# 查看数据表的创建语句
show create table 表名;
# 查看表结构
desc 表名;
```

删除数据表语法：

```sql
drop table 表名;
```

**修改数据表（改）**

数据表添加一列：

```sql
alter table 表名 add 字段名 类型(长度) [first|after 其他字段名称];
# first:把新添加字段放在第一位	|after 其他字段名称:把新添加字段放在指定字段的后面
```

数据表的列修改类型:

```sql
alter table 表名 modify 要修改的字段名 类型(长度) [约束];
```

数据表修改列名:

```sql
alter table 表名 change 旧列名 新列名 类型(长度) [约束];
```

数据表删除一列:

```sql
alter table 表名 drop 列名;
```

数据表修改表名：

```sql
rename table 表名 to 新表名;
```

## DML

数据操作命令，主要是指进行数据操作后，会对原有数据产生影响。

数据操作命令有：

> 1. 插入数据; insert
> 2. 删除数据; delete
> 3. 修改数据. update

**插入数据【增】**

（1）插入一条数据

```sql
insert into 表名[(字段名1,字段名2,字段名3,...)] values(值1,值2,值3,...);
```

（2）插入多条数据

```sql
insert into 表名[(字段名1,字段名2,字段名3,...)] values (值1,值2,值3,...),(值1,值2,值3,...),...;
```

**修改数据【改】**

（1）更新所有数据

```sql
update 表名 set 字段名1=值1, 字段名2=值2, 字段名3=值3,...;
```

（2）按条件修改数据

```sql
update 表名 set 字段名1=值1, 字段名2=值2, 字段名3=值3,…… where 条件;
```

**删除数据【删】**

（1）删除所有数据

```sql
delete from 表名;
```

（2）按条件删除数据

```sql
delete from 表名 where 条件;
```

## MySQL引擎

MySQL有多种引擎，能执行create table、select等命令，在数据量不多时，使用任何引擎都没什么关系。

在MySQL中，有3类引擎：

> 1. **InnoDB**是一个可靠的事务处理引擎，但是它不支持全文搜索; [逻辑单元]
> 2. MyISAM是一个性能极高的引擎，它支持全文搜索，但不支持[事务]处理; 
> 3. Memory在功能等同于MyISAM，但由于数据存储在内存中，速度很快，但占用内存大，因此几乎不使用此引擎.

MyISAM和InnoDB的区别

|    对比项    | MyISAM                                                     | InnoDB                                                       |
| :----------: | ---------------------------------------------------------- | ------------------------------------------------------------ |
|    主外键    | 不支持                                                     | 支持                                                         |
|     事务     | 不支持                                                     | 支持                                                         |
|    行表锁    | 表锁，即使操作一条记录也会锁住整个表，不适合高并发的操作。 | 行锁，操作时只锁某一行，不对其他行产生影响。特别适合高并发的操作。 |
|     缓存     | 只缓存索引，不缓存真实数据。                               | 不仅缓存索引，还缓存真实数据，对内存要求较高。               |
|    表空间    | 小                                                         | 大                                                           |
|    关注点    | 性能                                                       | 事务                                                         |
| 是否默认安装 | 是                                                         | 是                                                           |

**设定引擎**

```sql
create table 表名(
    字段名 数据类型(长度) [约束],
    ...
) engine = 引擎名 default charset utf8;
```

**清空数据的区别**

```sql
# 删除数据表数据
delete from 表名;
# 销毁及删除数据表数据
truncate  [table] 表名;
```

|                      | delete from                                            | truncate                                 |
| -------------------- | ------------------------------------------------------ | ---------------------------------------- |
| 属于哪种语言分类？   | 数据操作语言（DML）                                    | 数据定义语言（DDL）                      |
| 是否可设置条件删除？ | 可以带条件删除                                         | 不能带条件删除                           |
| 删除时具体操作如何？ | 删除大量数据速度慢，只删除数据，主键自增序列不会清零。 | 删除大量数据速度快，主键自增序列会清零。 |

## SQL约束

SQL约束是用于指定字段数据的规则，可以保证数据更加精确、可靠。

常见的SQL约束：

| 约束名称 | 关键字      | 含义                                                         |
| :------: | ----------- | ------------------------------------------------------------ |
|   主键   | primary key | MySQL建议所有表的主键字段都叫id，类型为int。                 |
|   非空   | not null    | 此字段不允许填写空值。                                       |
|   唯一   | unique      | 此字段的值不允许重复。                                       |
|  默认值  | default     | 当不填写字段对应的值时，会使用默认值；如果填写时，则以填写为准。 |
|   外键   | foreign key | 涉及到多张表时才会使用。 对表与表关系字段进行约束，当为表与表关系字段填写值时，会到关联的表中查询此值是否存在。 如果存在，则填写成功；如果不存在，则填写失败。 |

> - SQL约束不是必须的，而是为了让SQL更加规范而存在；
> - 在学习SQL过程中，为了便于初学者更好的理解SQL约束,会单独讲解SQL约束；
> - 在实际应用中，可以对字段同时设定多个SQL约束，且都是在创建数据表时进行设定。

**主键约束**

添加主键约束：

```sql
# 创建表时添加主键
create table 表名(
	字段名 数据类型(长度) primary key [其他约束],
	...
) engine = 引擎名 default charset utf8;
```

```sql
# 创建表后，使用alter table关键字添加主键
alter table 表名 add primary key(字段名);
```

> - 给primary key主键约束的字段设定值时，不允许出现重复值；[唯一性]
>
> - 主键约束列不能包含null值；[非空]
>
> - 每个表都应该有一个主键约束，且每个表只能有一个主键。

删除主键约束：

```sql
alter table 表名 drop primary key;
```

> - 删除主键约束后，该字段依旧有非空约束，不能为空。

主键约束字段自动增长:

```sql
create table 表名(
	字段名 数据类型(长度) primary key auto_increment,
	...
) engine = 引擎名 default charset utf8;
```

> - 自动增长列的数据类型必须是整型；
>
> - 自动增长列必须为X键（比如主键、外键）。

**非空约束**

添加非空约束:

```sql
create table 表名(
	字段名 数据类型(长度) [其他约束] not null,
	...
) engine = 引擎名 default charset utf8;
```

> - 当设定主键约束后，值默认是非空的；
> - 当给某列设定为not null后，在添加数据时必须向该字段传递非null值。

**唯一约束**

加唯一约束:

```sql
create table 表名(
	字段名 数据类型(长度) [其他约束] unique,
	...
) engine = 引擎名 default charset utf8;
```

> - 每个表可以有多个unique唯一约束，但是每个表只能有一个primary key主键约束；
>
> - 当设定为某字段唯一约束后，值是唯一的,给该字段添加已有值，则报错。

**默认值约束**

添加默认值约束:

```sql
create table 表名(
	字段名 数据类型(长度) [其他约束] default 值,
	...
) engine = 引擎名 default charset utf8;
```

> - 每个表可以有多个默认值约束；
>
> - 设置了默认值后，若不传递数值，则直接使用默认值。

## DQL

**简单查询**

```sql
# 查询表内所有数据
select * from 表名;
# 按不同字段名来查询表内数据,以指定的列来显示结果
select [distinct](去重) 字段名1,字段名2,... from 表名;
```

- > 查询出数据内容，通常称为结果集。

**比较查询**

对数据进行条件筛选处理

```sql
select [*|字段名1, 字段名2, ...] from 表名 where 条件;
```

比较运算符有：

|  比较运算符  | 含义           |
| :----------: | -------------- |
|      =       | 等于           |
|      >       | 大于           |
|      >=      | 大于等于       |
|      <       | 小于           |
|      <=      | 小于等于       |
| !=    [或<>] | 不等于，忽略<> |

**范围查询**

范围查询是指在某个范围内进行查询，分别有in和between...and...

```sql
# 非连续值的范围查询
select * from 表名 where 字段名 in (范围值1,范围值2,...);
# 值在连续范围的查询
select * from 表名 where 字段名 between 范围值1 and 范围值2;
```

**逻辑查询**

对数据进行条件筛选处理

```sql
select [*|字段名1, 字段名2, ...] from 表名 where 条件;
```

逻辑运算符有：

| 逻辑查询运算符 | 含义                                                         |
| :------------: | ------------------------------------------------------------ |
|      and       | 与、和、且。 <br/>1.逻辑运算符and的前后一般是True或False的结果； <br/>2.当两个条件都为True(真)，整个操作结果才是True真。 |
|       or       | 或、或者 <br/>1.逻辑运算符or的前后一般是True或False的结果； <br/>2.当两个条件都为False(假)，整个操作结果才是False假。 |
|      not       | 一般情况下，要设定not取反，对整个操作结果做not处理。         |

**模糊查询**

```sql
select * from 表名 where 字段名 like '%某个字%'; 
或
select * from 表名 where 字段名 like '某个字_';
```

> - %表示任意多个任意字符，_表示一个任意字符。

**非空查询**

```sql
select * from 表名 where 字段名 [条件]; 
```

非空运算符有：

| 非空运算符  | 含义         |
| :---------: | ------------ |
|   is null   | 判断为空。   |
| is not null | 判断为非空。 |

> - 此处的等于需要使用is来表示，可以简单的理解为是用于判断null对象。

**排序查询**

SQL查询通用语法：

```sql
select [*|字段名1,字段名2,...|函数(...)] from 表名 where 条件 另外的要求;
```

排序查询指的是对某字段进行升序或降序的形式来查询结果

```sql
select * from 表名 where 条件 order by 字段名 [asc|desc];
```

> - asc从小到大排列，即升序；
>
> - desc从大到小排序，即降序；
>
> - 默认按照列值从小到大进行排序（即asc升序）。

**聚合查询**

```sql
select 函数(...) from 表名 [where 条件];
```

聚合函数有：

| **聚合函数** | **作用**                             |
| :----------: | ------------------------------------ |
|  count(col)  | 用于统计指定列不为null的总数据条数。 |
|   sum(col)   | 用于计算指定列的数值和。             |
|   max(col)   | 用于计算指定列的最大值。             |
|   min(col)   | 用于计算指定列的最小值。             |
|   avg(col)   | 用于计算指定列的平均值。             |

> - 聚合函数是用于对一列数据进行统计，结果会返回一个单一的值；
>
> - 注意：聚合函数会忽略空值进行统计处理。

**分页查询**

当数据量太多时，为了更快的加载数据内容，可以进行分页处理。

```sql
select 字段名1,字段名2,... from 表名 limit M, N;
# M: 整数，表示从第几条索引开始，计算方式:(当前页-1) * 每页显示条数;
# N: 整数，表示查询多少条数据.
```

> - limit是分页查询的关键字；
>
> - M为整数，表示从第几条索引开始，默认值是0；
>
> - N为整数，表示查询多少条数据。

**分组查询**

分组查询指的是：将查询结果按照指定字段分组，其中，数值相等的可划分为同一组。

```sql
select 字段名1,字段名2,... from 表名 group by 分组字段名 [having 分组条件];
```

> - 分组字段名：表示按照指定字段的值进行分组；
>
> - group by的作用是实现分组，默认可以实现去重操作；
>
> - having分组条件是用来过滤分组后的数据。

**group by + 聚合函数**

```sql
select 字段名1,字段名2,聚合函数(...) from 表名 group by 分组字段名;
```

> 可用于分组统计数据。

**group by + having**

```sql
select 字段名1,字段名2,... from 表名 group by 分组字段名 having 分组条件;
```

> having用于过滤分组数据，且只能用于group by。
>
> having子句放在结尾处。

## 外键和关系

外键约束是用于多张数据表之间进行关联使用。

添加外键约束:

```sql
# 创建时添加外键
create table 表名(
	...
	字段名 数据类型(长度) [约束],
	foreign key (字段名) references 另外表名(主键列名)
) engine = InnoDB default charset utf8;
# 通过外部添加外键
alter table 表A add constraint xxxfk foreign key (外键字段名) references 另外表名(主键字段名);
```

> - 在设置外键约束时，需要使用到foreign key关键字；
>
> - 通常情况下，建议设定外键约束放在定义所有字段的结尾处。
> - 不可随意给已有关联的两张数据表添加和删除数据，否则容易报错

表与表之间的关系：

> 1. 一对一关系(1:1)
>
> 2. 一对多关系(1:N)   [常见]
>
> 3. 多对多关系(M:N)   [常见]

当数据表之间产生关联后，需要注意：

> - 不能给表B（外键）添加一个表A不存在的主键字段值；
>
> - 不能删除表B（外键）已使用表A存在的主键字段值。

**子查询**

子查询指的是将一条select语句的结果，作为另一条select语句的一部分（如：查询条件、查询结果、表等），来进行数据查询

```sql
select *|字段名1,字段名2,.. from 表名 where 字段名 = (另外select语句的结果);
```

> 在MySQL中，查询操作支持嵌套使用，其中，子查询就是嵌套使用的例子。

## 多表查询

多表查询，也可称为连接查询，可用于实现多个数据表之间的数据查询。

多表查询可以分为4类：

> 1. 交叉连接查询
> 2. 内连接查询
> 3. 外连接查询
> 4. 自连接查询

**交叉连接查询**

通常地，交叉连接查询的结果是：两个数据表的并集，也称为笛卡尔积。

```sql
select 字段名 from A表名, B表名;
或
select 字段名 from A表名 cross join B表名;
```

**内连接查询**

内连接查询指的是查询两个数据表中，符合条件的共有记录，即交集。

内连接查询，可分为两类，分别是：隐式内连接和显式内连接。

```sql
# 隐式内连接	没有inner join关键字，条件直接使用where来指定
select 字段名 from A表名, B表名 where 条件;
```

```sql
# 显式内连接 需要使用inner join ... on语句，可以省略inner
select 字段名 from A表名 别名 inner join B表名 别名 on 条件 [where 查询条件];
select 字段名 from A表名 别名 join B表名 别名 on 条件 [where 查询条件];
```

**外连接查询**

外连接查询需要使用关键字outer join，一般应用中会省略outer，而直接使用join。

此外，外连接查询还可分为两类，分别是：

```sql
# 1.左外连接查询
select 字段名 from A表名 别名 left [outer] join B表名 别名 on 条件;
# 2.右外连接查询
select 字段名 from A表名 别名 right [outer] join B表名 别名 on 条件;
```

> - 左外连接查询是以左表为主，并根据条件查询右表数据结果。
> - 右外连接查询是以右表为主，并根据条件查询左表数据结果。
> - 当左表有数据为null时，左外连接查询的结果中，右表的数据结果都为null值；
> - 当右表有数据为null时，右外连接查询的结果中，左表的数据结果都为null值。

**自连接查询**

自连接查询指的是：左表和右表都是同一个表，根据连接查询条件来查询两个表中的数据。

> 在进行连接查询操作时，必须为数据表定义别名！

```sql
select *|字段名1,字段名2,... from A表名 a join B表名 b on a.字段名 = b.字段名 [where 条件];
```

> 自连接查询常用于省市的多级关联处理